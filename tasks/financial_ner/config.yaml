task: "financial_ner"

# Clustering stage config
clustering:
  random_seed: 42
  input_filename: "Financial-NER-NLP_train.jsonl" # 7202 samples

  # Embedding generation parameters
  batch_size: 512

  # UMAP parameters
  umap_n_components: 30
  
  # HDBSCAN parameters
  hdbscan:
    min_cluster_size: 30
    min_samples: 1
    cluster_selection_epsilon: 0.16
    max_cluster_size: 250

# Evolution stage config
evolution:
  random_seed: 42
  subset_size: 5
  mu: 25
  lambda_: 75 # more offspring for broader search
  generations: 40
  cxpb: 0.45
  mutpb: 0.50 # exploration heavy, but still keep some reproduction
  tournsize: 2 # weak pressures aka more diversity
  indpb: 0.40
  max_inter_prob: 0.70 # bias mutations to other clusters (initial/max value)
  min_inter_prob: 0.10  # Minimum inter_prob when diversity is low (exploit mode)
  hof_size: 5
  workers: 8     

  # Early stopping
  early_stopping: true
  early_stopping_patience: 5  
  early_stopping_min_delta: 0.005  

# Evaluation config
evaluation:
  validation_file: "Financial-NER-NLP_dev.jsonl" # 900 samples
  validation_sample_ratio: 0.5 # = 450

  # Individual early stopping params
  early_stop_checkpoint_fraction: 0.25  # Check after evaluating this fraction of validation set (0.0 to 1.0)
  early_stop_std_multiplier: 1.0  # Removes roughly 16% if normal distribution

  # LLM config for evaluation
  llm:
    # model: "meta-llama/Meta-Llama-3-8B-Instruct"
    max_model_len: 4096
    gpu_memory_utilization: 0.90
    disable_log_stats: true
    temperature: 0.0
    max_tokens: 32

  prompt_template: |-
    Extract the named entities in the following text using 139 XBRL tags as labels in the IOB2 format.
    
    The XBRL tags include, for example: EquityMethodInvestments, IncomeLossFromEquityMethodInvestments, and UnrecognizedTaxBenefits.

    Here are some examples:

    {examples}

    Return the results in JSON format:
      - Each key must be an XBRL tag.
      - Each value must be a list of string values (the entities found).
      - If there are no entities in the text, return an empty JSON object.

    Text to analyze: '{input_text}'