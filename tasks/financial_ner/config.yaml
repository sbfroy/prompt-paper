task: "financial_ner"

# ============================================================================
# Dataset Configuration
# ============================================================================
dataset:
  size: 5000  # Number of examples in the generated dataset (used in artifact names)

# ============================================================================
# Clustering Stage Configuration
# ============================================================================
clustering:
  random_seed: 42

  # Embedding generation
  batch_size: 512

  # UMAP dimensionality reduction
  umap_n_components: 30

  # HDBSCAN clustering parameters
  hdbscan:
    min_cluster_size: 17
    min_samples: 4
    cluster_selection_epsilon: 0.20

# ============================================================================
# Evolution Stage Configuration
# ============================================================================
evolution:
  random_seed: 42
  subset_size: 5
  mu: 40
  lambda_: 120  # Offspring count for broader search
  generations: 40
  cxpb: 0.30  # Crossover probability
  mutpb: 0.55  # Mutation probability (exploration-heavy)
  tournsize: 2  # Tournament size (weak pressure for diversity)
  max_inter_prob: 0.80  # Initial inter-cluster mutation probability
  min_inter_prob: 0.10  # Minimum inter-cluster probability (exploit mode)
  hof_size: 5
  workers: 8

  # Early stopping configuration
  early_stopping: true
  early_stopping_patience: 5
  early_stopping_min_delta: 0.005  

# ============================================================================
# Evaluation Configuration
# ============================================================================
evaluation:
  validation_sample_ratio: 0.5  # Use 50% of validation data

  # Individual early stopping parameters
  early_stop_checkpoint_fraction: 0.25  # Check after 25% of validation set
  early_stop_std_multiplier: 1.0  # Removes ~16% if normal distribution
  early_stop_probability: 0.7  # Probability of stopping underperforming individuals

  # LLM evaluation parameters
  temperature: 0.0
  # max_tokens: 32

  # Prompt templates for NER evaluation
  system_prompt: |-
    You are a helpful assistant that performs Named Entity Recognition (NER) on financial text.
    Your task is to identify financial concepts and extract their associated values using XBRL accounting tags.
    Only respond with the requested JSON object and nothing else.

    The complete list of possible XBRL tags is:
    AccrualForEnvironmentalLossContingencies, AcquiredFiniteLivedIntangibleAssetsWeightedAverageUsefulLife, AllocatedShareBasedCompensationExpense, AmortizationOfFinancingCosts, AmortizationOfIntangibleAssets, AntidilutiveSecuritiesExcludedFromComputationOfEarningsPerShareAmount, AreaOfRealEstateProperty, AssetImpairmentCharges, BusinessAcquisitionEquityInterestsIssuedOrIssuableNumberOfSharesIssued, BusinessAcquisitionPercentageOfVotingInterestsAcquired, BusinessCombinationAcquisitionRelatedCosts, BusinessCombinationConsiderationTransferred1, BusinessCombinationContingentConsiderationLiability, BusinessCombinationRecognizedIdentifiableAssetsAcquiredAndLiabilitiesAssumedIntangibleAssetsOtherThanGoodwill, BusinessCombinationRecognizedIdentifiableAssetsAcquiredAndLiabilitiesAssumedIntangibles, CapitalizedContractCostAmortization, CashAndCashEquivalentsFairValueDisclosure, ClassOfWarrantOrRightExercisePriceOfWarrantsOrRights1, CommonStockCapitalSharesReservedForFutureIssuance, CommonStockDividendsPerShareDeclared, CommonStockParOrStatedValuePerShare, CommonStockSharesAuthorized, CommonStockSharesOutstanding, ConcentrationRiskPercentage1, ContractWithCustomerLiability, ContractWithCustomerLiabilityRevenueRecognized, CumulativeEffectOfNewAccountingPrincipleInPeriodOfAdoption, DebtInstrumentBasisSpreadOnVariableRate1, DebtInstrumentCarryingAmount, DebtInstrumentConvertibleConversionPrice1, DebtInstrumentFaceAmount, DebtInstrumentFairValue, DebtInstrumentInterestRateEffectivePercentage, DebtInstrumentInterestRateStatedPercentage, DebtInstrumentMaturityDate, DebtInstrumentRedemptionPricePercentage, DebtInstrumentTerm, DebtInstrumentUnamortizedDiscount, DebtWeightedAverageInterestRate, DeferredFinanceCostsGross, DeferredFinanceCostsNet, DefinedBenefitPlanContributionsByEmployer, DefinedContributionPlanCostRecognized, Depreciation, DerivativeFixedInterestRate, DerivativeNotionalAmount, DisposalGroupIncludingDiscontinuedOperationConsideration, EffectiveIncomeTaxRateContinuingOperations, EffectiveIncomeTaxRateReconciliationAtFederalStatutoryIncomeTaxRate, EmployeeServiceShareBasedCompensationNonvestedAwardsTotalCompensationCostNotYetRecognized, EmployeeServiceShareBasedCompensationNonvestedAwardsTotalCompensationCostNotYetRecognizedPeriodForRecognition1, EmployeeServiceShareBasedCompensationNonvestedAwardsTotalCompensationCostNotYetRecognizedShareBasedAwardsOtherThanOptions, EmployeeServiceShareBasedCompensationTaxBenefitFromCompensationExpense, EquityMethodInvestmentOwnershipPercentage, EquityMethodInvestments, FiniteLivedIntangibleAssetUsefulLife, GainsLossesOnExtinguishmentOfDebt, Goodwill, GoodwillImpairmentLoss, GuaranteeObligationsMaximumExposure, IncomeLossFromEquityMethodInvestments, IncomeTaxExpenseBenefit, InterestExpense, InterestExpenseDebt, LeaseAndRentalExpense, LesseeOperatingLeaseRenewalTerm, LesseeOperatingLeaseTermOfContract, LettersOfCreditOutstandingAmount, LineOfCredit, LineOfCreditFacilityCommitmentFeePercentage, LineOfCreditFacilityCurrentBorrowingCapacity, LineOfCreditFacilityInterestRateAtPeriodEnd, LineOfCreditFacilityMaximumBorrowingCapacity, LineOfCreditFacilityRemainingBorrowingCapacity, LineOfCreditFacilityUnusedCapacityCommitmentFeePercentage, LongTermDebt, LongTermDebtFairValue, LossContingencyAccrualAtCarryingValue, LossContingencyDamagesSoughtValue, LossContingencyEstimateOfPossibleLoss, LossContingencyPendingClaimsNumber, MinorityInterestOwnershipPercentageByNoncontrollingOwners, MinorityInterestOwnershipPercentageByParent, NumberOfOperatingSegments, NumberOfRealEstateProperties, NumberOfReportableSegments, OperatingLeaseCost, OperatingLeaseExpense, OperatingLeaseLiability, OperatingLeasePayments, OperatingLeaseRightOfUseAsset, OperatingLeaseWeightedAverageDiscountRatePercent, OperatingLeaseWeightedAverageRemainingLeaseTerm1, OperatingLeasesRentExpenseNet, OperatingLossCarryforwards, PaymentsToAcquireBusinessesGross, PaymentsToAcquireBusinessesNetOfCashAcquired, PreferredStockDividendRatePercentage, PreferredStockSharesAuthorized, ProceedsFromIssuanceOfCommonStock, PropertyPlantAndEquipmentUsefulLife, PublicUtilitiesRequestedRateIncreaseDecreaseAmount, RelatedPartyTransactionAmountsOfTransaction, RelatedPartyTransactionExpensesFromTransactionsWithRelatedParty, RepaymentsOfDebt, RestructuringAndRelatedCostExpectedCost1, RestructuringCharges, RevenueFromContractWithCustomerExcludingAssessedTax, RevenueFromContractWithCustomerIncludingAssessedTax, RevenueFromRelatedParties, RevenueRemainingPerformanceObligation, Revenues, SaleOfStockNumberOfSharesIssuedInTransaction, SaleOfStockPricePerShare, ShareBasedCompensation, ShareBasedCompensationArrangementByShareBasedPaymentAwardAwardVestingPeriod1, ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsGrantsInPeriod, ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsGrantsInPeriodWeightedAverageGrantDateFairValue, ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsNonvestedNumber, ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsVestedInPeriodTotalFairValue, ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized, ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant, ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsExercisesInPeriodTotalIntrinsicValue, ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsGrantsInPeriodGross, ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsGrantsInPeriodWeightedAverageGrantDateFairValue, SharePrice, SharebasedCompensationArrangementBySharebasedPaymentAwardAwardVestingRightsPercentage, SharebasedCompensationArrangementBySharebasedPaymentAwardExpirationPeriod, StockIssuedDuringPeriodSharesNewIssues, StockRepurchaseProgramAuthorizedAmount1, StockRepurchaseProgramRemainingAuthorizedRepurchaseAmount1, StockRepurchasedAndRetiredDuringPeriodShares, StockRepurchasedDuringPeriodShares, SupplementalInformationForPropertyCasualtyInsuranceUnderwritersPriorYearClaimsAndClaimsAdjustmentExpense, TreasuryStockAcquiredAverageCostPerShare, TreasuryStockSharesAcquired, TreasuryStockValueAcquiredCostMethod, UnrecognizedTaxBenefits, UnrecognizedTaxBenefitsThatWouldImpactEffectiveTaxRate

  user_prompt: |-
    Perform Named Entity Recognition on the financial text provided below. Identify specific values and associate them with the appropriate XBRL accounting tags from the list provided in the system prompt.

    Here are some examples of how to perform this task:

    {examples}

    CRITICAL RULES:
    1. Extract values EXACTLY as they appear in the input text
    2. If a number is written as digits (e.g., "5.5", "2.8", "750"), extract it as-is
    3. If a number is written as words (e.g., "three", "four"), extract it as-is (do NOT convert to digits)
    4. Remove ONLY currency symbols ($, €, £) and unit words (billion, million, thousand)
    5. Remove ONLY the % symbol from percentages: "5.5%" → "5.5"
    6. Preserve all decimal precision exactly as written

    Return JSON format:
    - Each key: an XBRL tag from the system prompt list
    - Each value: a list of extracted string values
    - If no XBRL entities found: return empty object {{}}

    Now extract named entities from this input:
    '{input_text}'

# ============================================================================
# Generation Configuration
# ============================================================================
generation:
  batch_size_examples: 20  # Examples to request per API call
  base_temperature: 0.7
  chunk_size: 3500  # Characters per random text sample

  system_prompt: |-
    You are an expert at Named Entity Recognition (NER) for financial documents.
    Your task is to generate training examples that help models identify financial concepts and extract their associated values using XBRL accounting tags.
    Follow instructions carefully regarding whether to include or exclude XBRL entities.

    The complete list of possible XBRL tags is:
    AccrualForEnvironmentalLossContingencies, AcquiredFiniteLivedIntangibleAssetsWeightedAverageUsefulLife, AllocatedShareBasedCompensationExpense, AmortizationOfFinancingCosts, AmortizationOfIntangibleAssets, AntidilutiveSecuritiesExcludedFromComputationOfEarningsPerShareAmount, AreaOfRealEstateProperty, AssetImpairmentCharges, BusinessAcquisitionEquityInterestsIssuedOrIssuableNumberOfSharesIssued, BusinessAcquisitionPercentageOfVotingInterestsAcquired, BusinessCombinationAcquisitionRelatedCosts, BusinessCombinationConsiderationTransferred1, BusinessCombinationContingentConsiderationLiability, BusinessCombinationRecognizedIdentifiableAssetsAcquiredAndLiabilitiesAssumedIntangibleAssetsOtherThanGoodwill, BusinessCombinationRecognizedIdentifiableAssetsAcquiredAndLiabilitiesAssumedIntangibles, CapitalizedContractCostAmortization, CashAndCashEquivalentsFairValueDisclosure, ClassOfWarrantOrRightExercisePriceOfWarrantsOrRights1, CommonStockCapitalSharesReservedForFutureIssuance, CommonStockDividendsPerShareDeclared, CommonStockParOrStatedValuePerShare, CommonStockSharesAuthorized, CommonStockSharesOutstanding, ConcentrationRiskPercentage1, ContractWithCustomerLiability, ContractWithCustomerLiabilityRevenueRecognized, CumulativeEffectOfNewAccountingPrincipleInPeriodOfAdoption, DebtInstrumentBasisSpreadOnVariableRate1, DebtInstrumentCarryingAmount, DebtInstrumentConvertibleConversionPrice1, DebtInstrumentFaceAmount, DebtInstrumentFairValue, DebtInstrumentInterestRateEffectivePercentage, DebtInstrumentInterestRateStatedPercentage, DebtInstrumentMaturityDate, DebtInstrumentRedemptionPricePercentage, DebtInstrumentTerm, DebtInstrumentUnamortizedDiscount, DebtWeightedAverageInterestRate, DeferredFinanceCostsGross, DeferredFinanceCostsNet, DefinedBenefitPlanContributionsByEmployer, DefinedContributionPlanCostRecognized, Depreciation, DerivativeFixedInterestRate, DerivativeNotionalAmount, DisposalGroupIncludingDiscontinuedOperationConsideration, EffectiveIncomeTaxRateContinuingOperations, EffectiveIncomeTaxRateReconciliationAtFederalStatutoryIncomeTaxRate, EmployeeServiceShareBasedCompensationNonvestedAwardsTotalCompensationCostNotYetRecognized, EmployeeServiceShareBasedCompensationNonvestedAwardsTotalCompensationCostNotYetRecognizedPeriodForRecognition1, EmployeeServiceShareBasedCompensationNonvestedAwardsTotalCompensationCostNotYetRecognizedShareBasedAwardsOtherThanOptions, EmployeeServiceShareBasedCompensationTaxBenefitFromCompensationExpense, EquityMethodInvestmentOwnershipPercentage, EquityMethodInvestments, FiniteLivedIntangibleAssetUsefulLife, GainsLossesOnExtinguishmentOfDebt, Goodwill, GoodwillImpairmentLoss, GuaranteeObligationsMaximumExposure, IncomeLossFromEquityMethodInvestments, IncomeTaxExpenseBenefit, InterestExpense, InterestExpenseDebt, LeaseAndRentalExpense, LesseeOperatingLeaseRenewalTerm, LesseeOperatingLeaseTermOfContract, LettersOfCreditOutstandingAmount, LineOfCredit, LineOfCreditFacilityCommitmentFeePercentage, LineOfCreditFacilityCurrentBorrowingCapacity, LineOfCreditFacilityInterestRateAtPeriodEnd, LineOfCreditFacilityMaximumBorrowingCapacity, LineOfCreditFacilityRemainingBorrowingCapacity, LineOfCreditFacilityUnusedCapacityCommitmentFeePercentage, LongTermDebt, LongTermDebtFairValue, LossContingencyAccrualAtCarryingValue, LossContingencyDamagesSoughtValue, LossContingencyEstimateOfPossibleLoss, LossContingencyPendingClaimsNumber, MinorityInterestOwnershipPercentageByNoncontrollingOwners, MinorityInterestOwnershipPercentageByParent, NumberOfOperatingSegments, NumberOfRealEstateProperties, NumberOfReportableSegments, OperatingLeaseCost, OperatingLeaseExpense, OperatingLeaseLiability, OperatingLeasePayments, OperatingLeaseRightOfUseAsset, OperatingLeaseWeightedAverageDiscountRatePercent, OperatingLeaseWeightedAverageRemainingLeaseTerm1, OperatingLeasesRentExpenseNet, OperatingLossCarryforwards, PaymentsToAcquireBusinessesGross, PaymentsToAcquireBusinessesNetOfCashAcquired, PreferredStockDividendRatePercentage, PreferredStockSharesAuthorized, ProceedsFromIssuanceOfCommonStock, PropertyPlantAndEquipmentUsefulLife, PublicUtilitiesRequestedRateIncreaseDecreaseAmount, RelatedPartyTransactionAmountsOfTransaction, RelatedPartyTransactionExpensesFromTransactionsWithRelatedParty, RepaymentsOfDebt, RestructuringAndRelatedCostExpectedCost1, RestructuringCharges, RevenueFromContractWithCustomerExcludingAssessedTax, RevenueFromContractWithCustomerIncludingAssessedTax, RevenueFromRelatedParties, RevenueRemainingPerformanceObligation, Revenues, SaleOfStockNumberOfSharesIssuedInTransaction, SaleOfStockPricePerShare, ShareBasedCompensation, ShareBasedCompensationArrangementByShareBasedPaymentAwardAwardVestingPeriod1, ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsGrantsInPeriod, ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsGrantsInPeriodWeightedAverageGrantDateFairValue, ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsNonvestedNumber, ShareBasedCompensationArrangementByShareBasedPaymentAwardEquityInstrumentsOtherThanOptionsVestedInPeriodTotalFairValue, ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAuthorized, ShareBasedCompensationArrangementByShareBasedPaymentAwardNumberOfSharesAvailableForGrant, ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsExercisesInPeriodTotalIntrinsicValue, ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsGrantsInPeriodGross, ShareBasedCompensationArrangementByShareBasedPaymentAwardOptionsGrantsInPeriodWeightedAverageGrantDateFairValue, SharePrice, SharebasedCompensationArrangementBySharebasedPaymentAwardAwardVestingRightsPercentage, SharebasedCompensationArrangementBySharebasedPaymentAwardExpirationPeriod, StockIssuedDuringPeriodSharesNewIssues, StockRepurchaseProgramAuthorizedAmount1, StockRepurchaseProgramRemainingAuthorizedRepurchaseAmount1, StockRepurchasedAndRetiredDuringPeriodShares, StockRepurchasedDuringPeriodShares, SupplementalInformationForPropertyCasualtyInsuranceUnderwritersPriorYearClaimsAndClaimsAdjustmentExpense, TreasuryStockAcquiredAverageCostPerShare, TreasuryStockSharesAcquired, TreasuryStockValueAcquiredCostMethod, UnrecognizedTaxBenefits, UnrecognizedTaxBenefitsThatWouldImpactEffectiveTaxRate

  # Prompt for generating examples WITH XBRL entities
  positive_user_prompt: |-
    Using the following financial text as reference, generate exactly {batch_size_examples} NER training examples that CONTAIN XBRL entities.

    Financial Text:
    {text_chunk}

    For each example:
    1. Create a realistic financial sentence (extract from above, adapt, or create similar)
    2. Identify ALL relevant XBRL tags (from the system prompt list) and extract the specific values

    Return a JSON array with exactly {batch_size_examples} objects:
    - "input": financial sentence
    - "output": dictionary mapping XBRL tags to lists of extracted values

    CRITICAL EXTRACTION RULES:
    1. Extract values EXACTLY as they appear in the input text
    2. If a number is written as digits (e.g., "5.5", "2.8", "750"), extract it as-is
    3. If a number is written as words (e.g., "three", "four"), extract it as-is (do NOT convert to digits)
    4. Remove ONLY currency symbols ($, €, £) and unit words (billion, million, thousand)
    5. Remove ONLY the % symbol from percentages: "5.5%" → "5.5"
    6. Preserve all decimal precision exactly as written

    IMPORTANT: ALL examples MUST have at least one XBRL tag. Create diverse examples with 1-5 tags each, varying complexity and sentence length.

  # Prompt for generating examples WITHOUT XBRL entities
  negative_user_prompt: |-
    Using the following financial text as reference, generate exactly {batch_size_examples} NER training examples that DO NOT CONTAIN any XBRL entities.

    Financial Text:
    {text_chunk}

    For each example:
    1. Create realistic financial sentences that discuss general concepts, qualitative statements, or procedural information
    2. These should be financial text that has NO extractable numeric values, dates, or specific entity names

    Return a JSON array with exactly {batch_size_examples} objects:
    - "input": financial sentence with NO extractable XBRL data
    - "output": "No XBRL associated data."

    IMPORTANT: ALL examples MUST have output set to the string "No XBRL associated data." These should be realistic financial sentences that simply don't contain extractable entities.
