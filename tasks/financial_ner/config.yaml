task: "financial_ner"

# Clustering stage config
clustering:
  random_seed: 42
  input_filename: "Financial-NER-NLP_train.jsonl" # 7202 samples

  # Embedding generation parameters
  batch_size: 512

  # UMAP parameters
  umap_n_components: 30
  
  # HDBSCAN parameters
  hdbscan:
    min_cluster_size: 30
    min_samples: 1
    cluster_selection_epsilon: 0.16
    max_cluster_size: 250

# Evolution stage config
evolution:
  random_seed: 42
  subset_size: 5
  mu: 25
  lambda_: 75 # more offspring for broader search
  generations: 40
  cxpb: 0.45
  mutpb: 0.50 # exploration heavy, but still keep some reproduction
  tournsize: 2 # weak pressures aka more diversity
  indpb: 0.40
  max_inter_prob: 0.70 # bias mutations to other clusters (initial/max value)
  min_inter_prob: 0.10  # Minimum inter_prob when diversity is low (exploit mode)
  hof_size: 5
  workers: 8     

  # Early stopping
  early_stopping: true
  early_stopping_patience: 5  
  early_stopping_min_delta: 0.005  

# Evaluation config
evaluation:
  validation_file: "Financial-NER-NLP_dev.jsonl" # 900 samples
  validation_sample_ratio: 0.5 # = 450

  # Individual early stopping params
  early_stop_checkpoint_fraction: 0.25  # Check after evaluating this fraction of validation set (0.0 to 1.0)
  early_stop_std_multiplier: 1.0  # Removes roughly 16% if normal distribution
  early_stop_probability: 0.7  # Probability of actually stopping an individual that meets early stop criteria (0.0 to 1.0)

  # LLM params + prompt templates for evaluation
  temperature: 0.0
  #max_tokens: 32
  system_prompt: |-
    You are a helpful assistant that performs Named Entity Recognition (NER) on financial text.
    Your goal is to identify financial concepts and accounting terms related to company performance, assets, liabilities, equity, revenue, and expenses.
    Only respond with the requested JSON object and nothing else.

  user_prompt: |-
    Extract the named entities in the following text using 139 XBRL tags as labels in the IOB2 format.
    
    The XBRL tags include, for example: EquityMethodInvestments, IncomeLossFromEquityMethodInvestments, and UnrecognizedTaxBenefits.

    Here are some examples:

    {examples}

    Return the results in JSON format:
      - Each key must be an XBRL tag.
      - Each value must be a list of string values (the entities found).
      - If there are no entities in the text, return an empty JSON object.

    Input: '{input_text}'

generation:
  scope_directory: "/workspace/tasks/financial_ner/data/scope"
  target_num_examples: 2000
  batch_size_examples: 50
  temperature: 0.7  
  
  system_prompt: |- 
    You are an expert at Named Entity Recognition (NER) for financial documents.
    Your task is to generate training examples that help models identify financial concepts and accounting terms.
    You must create realistic, diverse examples based on the provided financial text.

  user_prompt: |-
    Based on the following financial text excerpt, generate exactly {batch_size_examples} NER training examples.
    
    Financial Text:
    {text_batch}
    
    For each example:
    1. Extract a sentence or short passage from the text above
    2. Identify all relevant XBRL tags and their corresponding entities
    
    Use XBRL tags such as:
    - EquityMethodInvestments, IncomeLossFromEquityMethodInvestments, UnrecognizedTaxBenefits
    - Assets, Liabilities, StockholdersEquity, Revenues, OperatingExpenses
    - CashAndCashEquivalents, AccountsReceivable, PropertyPlantAndEquipment
    - And any of the other 139 available XBRL financial tags
    
    Return a JSON array with exactly {batch_size_examples} objects, each containing:
    - "input": the extracted sentence/passage
    - "output": a dictionary mapping XBRL tags to lists of identified entities (or "No XBRL associated data." if none found)
    
    Example format:
    [
      {{
        "input": "The company reported total assets of $5.2 billion as of December 31, 2023.",
        "output": {{"Assets": ["5.2 billion"]}}
      }},
      {{
        "input": "Net income for the quarter was affected by various factors.",
        "output": "No XBRL associated data."
      }}
    ]
    
    Ensure diversity in the examples - vary sentence length, complexity, and types of financial information extracted.
