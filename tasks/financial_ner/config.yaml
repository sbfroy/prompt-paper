task: "financial_ner"

# Clustering stage config
clustering:
  random_seed: 42
  input_filename: "Financial-NER-NLP_train.jsonl" # 7202 samples

  # Embedding generation parameters
  batch_size: 512

  # UMAP parameters
  umap_n_components: 30
  
  # HDBSCAN parameters
  hdbscan:
    min_cluster_size: 30
    min_samples: 1
    cluster_selection_epsilon: 0.16
    max_cluster_size: 250

# Evolution stage config
evolution:
  random_seed: 42
  subset_size: 5
  mu: 40
  lambda_: 120 # more offspring for broader search
  generations: 40
  cxpb: 0.30
  mutpb: 0.55 # exploration heavy, but still keep some reproduction
  tournsize: 2 # weak pressures aka more diversity
  max_inter_prob: 0.80 # bias mutations to other clusters (initial/max value)
  min_inter_prob: 0.10  # Minimum inter_prob when diversity is low (exploit mode)
  hof_size: 5
  workers: 8     

  # Early stopping
  early_stopping: true
  early_stopping_patience: 5  
  early_stopping_min_delta: 0.005  

# Evaluation config
evaluation:
  validation_file: "Financial-NER-NLP_dev.jsonl" # 900 samples
  validation_sample_ratio: 1.0 # = 900

  # Individual early stopping params
  early_stop_checkpoint_fraction: 0.25  # Check after evaluating this fraction of validation set (0.0 to 1.0)
  early_stop_std_multiplier: 1.0  # Removes roughly 16% if normal distribution
  early_stop_probability: 0.7  # Probability of actually stopping an individual that meets early stop criteria (0.0 to 1.0)

  # LLM params + prompt templates for evaluation
  temperature: 0.0
  #max_tokens: 32
  system_prompt: |-
    You are a helpful assistant that performs Named Entity Recognition (NER) on financial text.
    Your goal is to identify financial concepts and accounting terms related to company performance, assets, liabilities, equity, revenue, and expenses.
    Only respond with the requested JSON object and nothing else.

  user_prompt: |-
    Extract the named entities in the following text using 139 XBRL tags as labels in the IOB2 format.
    
    The XBRL tags include, for example: EquityMethodInvestments, IncomeLossFromEquityMethodInvestments, and UnrecognizedTaxBenefits.

    Here are some examples:

    {examples}

    Return the results in JSON format:
      - Each key must be an XBRL tag.
      - Each value must be a list of string values (the entities found).
      - If there are no entities in the text, return an empty JSON object.

    Input: '{input_text}'

generation:
  target_num_examples: 2000 # k (Both positive and negative)
  batch_size_examples: 25  # How many examples to request per API call
  base_temperature: 0.7
  chunk_size: 2000  # Characters per random sample
  
  system_prompt: |- 
    You are an expert at Named Entity Recognition (NER) for financial documents.
    Your task is to generate training examples that help models identify financial concepts and accounting terms.
    Follow instructions carefully regarding whether to include or exclude XBRL entities.

  positive_user_prompt: |-
    Using the following financial text as reference, generate exactly {batch_size_examples} NER training examples that CONTAIN XBRL entities.

    Financial Text:
    {text_chunk}

    For each example:
    1. Create a realistic financial sentence (extract from above, adapt, or create similar)
    2. Identify ALL relevant XBRL tags and extract the specific values (numbers, dates, entity names)

    Use XBRL tags like: EquityMethodInvestments, IncomeLossFromEquityMethodInvestments, UnrecognizedTaxBenefits, NumberOfOperatingSegments, Assets, Liabilities, Revenues, etc.

    Return a JSON array with exactly {batch_size_examples} objects:
    - "input": financial sentence
    - "output": dictionary mapping XBRL tags to lists of extracted values (e.g., {{"Assets": ["5.2 billion"], "Liabilities": ["3.1 billion"]}})

    IMPORTANT: ALL examples MUST have at least one XBRL tag. Create diverse examples with 1-5 tags each, varying complexity and sentence length.

  negative_user_prompt: |-
    Using the following financial text as reference, generate exactly {batch_size_examples} NER training examples that DO NOT CONTAIN any XBRL entities.

    Financial Text:
    {text_chunk}

    For each example:
    1. Create realistic financial sentences that discuss general concepts, qualitative statements, or procedural information
    2. These should be financial text that has NO extractable numeric values, dates, or specific entity names

    Return a JSON array with exactly {batch_size_examples} objects:
    - "input": financial sentence with NO extractable XBRL data
    - "output": "No XBRL associated data."

    IMPORTANT: ALL examples MUST have output set to the string "No XBRL associated data." These should be realistic financial sentences that simply don't contain extractable entities.
